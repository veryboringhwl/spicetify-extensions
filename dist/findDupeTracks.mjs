
        import Dexie from "https://esm.sh/dexie";
        (async function() {
          while (!Spicetify.React || !Spicetify.ReactDOM) {
          await new Promise(resolve => setTimeout(resolve, 10));
        }
var Ve=Object.create;var ge=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Je=Object.getPrototypeOf,Qe=Object.prototype.hasOwnProperty;var se=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var je=(e,t,o,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of qe(t))!Qe.call(e,a)&&a!==o&&ge(e,a,{get:()=>t[a],enumerable:!(i=Ge(t,a))||i.enumerable});return e};var n=(e,t,o)=>(o=e!=null?Ve(Je(e)):{},je(t||!e||!e.__esModule?ge(o,"default",{value:e,enumerable:!0}):o,e));var f=se((ft,fe)=>{fe.exports=Spicetify.ReactJSX});var I=se((_t,be)=>{be.exports=Spicetify.React});var ie=se((ht,_e)=>{_e.exports=Spicetify.ReactDOM});var ae=n(f(),1),_={editButton:"M17.318 1.975a3.329 3.329 0 114.707 4.707L8.451 20.256c-.49.49-1.082.867-1.735 1.103L2.34 22.94a1 1 0 01-1.28-1.28l1.581-4.376a4.726 4.726 0 011.103-1.735L17.318 1.975zm3.293 1.414a1.329 1.329 0 00-1.88 0L5.159 16.963c-.283.283-.5.624-.636 1l-.857 2.372 2.371-.857a2.726 2.726 0 001.001-.636L20.611 5.268a1.329 1.329 0 000-1.879z",settings:"M7.96 5.33a2.67 2.67 90 100 5.34 2.67 2.67 90 000-5.34ZM6.67 8A1.33 1.33 90 119.33 8 1.33 1.33 90 016.67 8Zm4.82-4.81a.95.94 90 01-1.1-.75L10.05.55A.47.47 90 009.68.17 8.1 8.1 90 006.32.17.47.47 90 005.96.55L5.61 2.44a.95.95 90 01-1.25.71L2.55 2.51a.47.47 90 00-.51.13C1.28 3.47.71 4.46.36 5.53a.47.47 90 00.14.51L1.97 7.28a.94.94 90 010 1.43L.5 9.95a.47.47 90 00-.14.51 7.98 7.98 90 001.68 2.9.47.47 90 00.51.13l1.81-.65a.94.94 90 011.25.72l.34 1.89c.04.18.18.33.37.37a8.1 8.1 90 003.36 0 .47.47 90 00.37-.37l.34-1.89a.95.95 90 011.25-.72l1.81.65c.18.06.38.01.51-.13.76-.84 1.34-1.82 1.68-2.9a.47.47 90 00-.14-.5L14.03 8.72a.94.94 90 010-1.44L15.5 6.04a.47.47 90 00.14-.5 7.98 7.98 90 00-1.68-2.9.47.47 90 00-.51-.13l-1.81.65a.95.95 90 01-.15.04Zm-8.82.78 1.25.44a2.28 2.28 90 003-1.73l.24-1.3a6.81 6.81 90 011.68 0l.24 1.3a2.28 2.28 90 003.01 1.73l1.24-.44c.34.44.63.93.84 1.44l-1 .85a2.27 2.27 90 000 3.48l1 .85a6.65 6.65 90 01-.84 1.44l-1.24-.44A2.28 2.28 90 009.08 13.32l-.24 1.29a6.8 6.8 90 01-1.69 0l-.23-1.29A2.28 2.28 90 003.91 11.59l-1.24.44a6.65 6.65 90 01-.84-1.44l1-.86a2.27 2.27 90 000-3.47l-1-.85c.21-.51.5-1 .84-1.44Z",github:"M12.2135 0C18.947 0 24.4267 5.5 24.4066 12.3041c0 5.4391-3.4983 10.0428-8.3513 11.6728-.6065.1223-.829-.265-.829-.591 0-.4072.02-1.7315.02-3.3815 0-1.1613-.384-1.8945-.829-2.2815 2.73-.3058 5.581-1.3445 5.581-6.0708 0-1.3445-.465-2.4445-1.2537-3.3.1213-.3055.5463-1.5688-.1212-3.2595 0 0-1.0312-.326-3.3567 1.263-.9707-.2648-2.0219-.4075-3.0532-.4075A11.7425 11.7425 90 009.16 6.3556c-2.3252-1.589-3.3565-1.263-3.3565-1.263-.6675 1.6907-.2427 2.954-.1215 3.2595-.7685.8555-1.2535 1.9555-1.2535 3.3 0 4.7263 2.8509 5.7855 5.5607 6.0708-.3437.3055-.6675.8555-.7685 1.65-.7077.326-2.467.8555-3.5587-1.0185 0 0-.6472-1.1815-1.8807-1.263 0 0-1.193 0-.081.7538 0 0 .809.3665 1.355 1.7925 0 0 .7075 2.2002 4.105 1.4667 0 1.0188.02 1.9965.02 2.2818 0 .3258-.2222.713-.829.5905C3.4983 22.3472 0 17.7432 0 12.3042 0 5.5 5.4597 0 12.2135 0Z",close:"M31.098 29.794 16.955 15.65 31.097 1.51 29.683.093 15.54 14.237 1.4.094-.016 1.508 14.126 15.65-.016 29.795l1.414 1.414L15.54 17.065l14.144 14.143",warning:"M13 14V9H11v5Zm0 2H11v2h2Zm8.884 3.5A1 1 0 0121 21H3a1 1 0 01-.884-1.468l9-17c.346-.654 1.422-.654 1.768 0Z",more:"M3 8A1.5 1.5 0 110 8a1.5 1.5 0 013 0zm6.5 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM16 8a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z",questionMark:"M12 2c5.523 0 10 4.478 10 10s-4.477 10-10 10S2 17.522 2 12 6.477 2 12 2Zm0 1.667c-4.595 0-8.333 3.738-8.333 8.333S7.405 20.333 12 20.333 20.333 16.595 20.333 12c0-4.595-3.738-8.333-8.333-8.333ZM12 15.5a1 1 0 110 2 1 1 0 010-2Zm0-8.75a2.75 2.75 0 012.75 2.75c0 1.01-.297 1.574-1.051 2.359l-.169.171c-.622.622-.78.886-.78 1.47a.75.75 0 01-1.5 0c0-1.01.297-1.574 1.051-2.359l.169-.171c.622-.622.78-.886.78-1.47a1.25 1.25 0 00-2.493-.128l-.007.128a.75.75 0 01-1.5 0A2.75 2.75 0 0112 6.75Z",dropdown:"M20.4614 6.3469a1.506 1.506 90 00-2.1125.1919L12 14.1564 5.651 6.5389a1.4997 1.4997 90 10-2.3028 1.922l7.5004 9.0004a1.4992 1.4992 90 002.3028 0l7.5004-9.0005a1.5019 1.5019 90 00-.1904-2.1139Z",palette:"M12 2c5.461 0 9.965 4.012 9.992 8.84 0 3.051-2.504 5.554-5.555 5.554H14.441a1.64 1.64 0 00-1.668 1.668c0 .473.148.836.438 1.125.257.29.437.688.437 1.125C13.648 21.254 12.926 22 12 22 6.5 22 2 17.5 2 12S6.5 2 12 2Z",duplicate:"M15 3.5c0-.5-.5-1-1-1H11V1c0-.5-.5-1-1-1H2C1.5 0 1 .5 1 1V11.5c0 .5.5 1 1 1H4.5V15c0 .5.5 1 1 1H14c.5 0 1-.5 1-1ZM2.5 2c0-.25.25-.5.5-.5H9c.25 0 .5.25.5.5v8.5c0 .25-.25.5-.5.5H3c-.25 0-.5-.25-.5-.5Zm4 12.5c-.25 0-.5-.25-.5-.5V12.5h4c.5 0 1-.5 1-1V4h2c.25 0 .5.25.5.5V14c0 .25-.25.5-.5.5Z"},z=(e,t=16)=>({size:o=t,fill:i="currentColor"})=>(0,ae.jsx)("svg",{viewBox:`0 0 ${t} ${t}`,width:o,height:o,fill:i,children:(0,ae.jsx)("path",{d:e})});_.React={editButton:z(_.editButton,24),settings:z(_.settings,16),github:z(_.github,24),close:z(_.close,32),warning:z(_.warning,24),more:z(_.more,16),questionMark:z(_.questionMark,24),dropdown:z(_.dropdown,24),palette:z(_.palette,24),duplicate:z(_.duplicate,16)};_.HTML={editButton:`<path d="${_.editButton}"/>`,settings:`<path d="${_.settings}"/>`,github:`<path d="${_.github}"/>`,close:`<path d="${_.close}"/>`,warning:`<path d="${_.warning}"/>`,more:`<path d="${_.more}"/>`,questionMark:`<path d="${_.questionMark}"/>`,dropdown:`<path d="${_.dropdown}"/>`,palette:`<path d="${_.palette}"/>`,duplicate:`<path d="${_.duplicate}"/>`};var R=_;(()=>{let e=`.Modal__overlay{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;background-color:rgba(var(--spice-rgb-shadow),.5);border-radius:7px}.Modal{background-color:unset}.Modal__container{display:flex;flex-direction:column;background-color:rgba(var(--spice-rgb-main),.9)!important;backdrop-filter:blur(20px) saturate(1.4) brightness(1.2);width:500px;max-height:500px;border-radius:7px;box-shadow:0 0 20px rgba(var(--spice-rgb-shadow),.5)!important}.Modal__container--large{max-height:80vh;width:clamp(550px,60vw,650px)}.Modal__header{display:flex;justify-content:space-between;padding:32px 32px 12px;border-bottom:1px solid rgba(var(--spice-rgb-selected-row),.1)}.Modal__titleContainer{display:flex;gap:8px}.Modal__icon{display:flex;align-items:center}.Modal__title{display:flex}.Modal__buttonContainer{display:flex;align-items:center;gap:8px}.Modal__button{background-color:var(--spice-highlight);border-radius:8px;height:34px;cursor:pointer;padding:8px;border:0}.Modal__button:hover{transform:scale(1.1)}.Modal__button:active{transform:scale(.9)}.Modal__content{display:flex;padding:16px 24px!important;overflow:auto;scrollbar-gutter:stable both-edges}
`,t="shared-popupModal.css";if(document.getElementById(t))return;let o=document.createElement("style");o.id=t,o.textContent=e,document.head.appendChild(o)})();var V=n(I(),1),he=n(ie(),1);var M=n(f(),1),A=null,H=null,j=()=>{H&&A&&(H.unmount(),A.remove(),document.body.style.overflow="auto",document.removeEventListener("keydown",ye),document.removeEventListener("mousedown",xe),A=null,H=null)},ye=e=>{e.key==="Escape"&&j()},xe=e=>{e.target.classList.contains("Modal__overlay")&&j()},ve=({title:e="",content:t,isLarge:o=!0,buttons:i=null,icon:a=""}={})=>{A=document.getElementById("popup-modal"),A||(A=document.createElement("popup-modal"),A.id="popup-modal",document.body.appendChild(A)),H=he.default.createRoot(A),document.addEventListener("keydown",ye),document.addEventListener("mousedown",xe);let p=(0,V.memo)(()=>(0,M.jsx)("div",{className:"Modal__overlay",children:(0,M.jsx)("div",{className:"Modal",children:(0,M.jsxs)("div",{className:`Modal__container${o?" Modal__container--large":""}`,children:[(0,M.jsxs)("div",{className:"Modal__header",children:[(0,M.jsxs)("div",{className:"Modal__titleContainer",children:[(0,M.jsx)("div",{className:"Modal__icon",children:a}),(0,M.jsx)("h1",{className:"Modal__title",children:e})]}),(0,M.jsxs)("div",{className:"Modal__buttonContainer",children:[i,(0,M.jsx)(Spicetify.ReactComponent.TooltipWrapper,{label:"Close",placement:"top",children:(0,M.jsx)("button",{type:"button",className:"Modal__button Modal__button--close",onClick:()=>j(),children:(0,M.jsx)(R.React.close,{size:18})})})]})]}),(0,M.jsx)("div",{className:"Modal__content",children:V.default.isValidElement(t)?t:V.default.createElement(t)})]})})}));H.render((0,M.jsx)(p,{}))};ve.hide=j;var X=ve;var S=n(I(),1);var ne=n(I(),1),we=n(ie(),1),Y=n(f(),1);function Xe({titleText:e,descriptionText:t,cancelText:o="Cancel",confirmText:i="Confirm",onConfirm:a,onClose:p,onOpen:g,onOutside:l,confirmLabel:u,allowHTML:s}){let c=ne.default.memo(()=>{let[y,m]=Spicetify.React.useState(!0),N=document.querySelector(".ReactModalPortal:last-of-type");return ne.default.useEffect(()=>{y&&g?.()},[y,g]),(0,Y.jsx)(Spicetify.ReactComponent.RemoteConfigProvider,{configuration:Spicetify.Platform.RemoteConfiguration,children:(0,Y.jsx)(Spicetify.ReactComponent.ConfirmDialog,{titleText:e,descriptionText:t,cancelText:o,confirmText:i,isOpen:y,onOutside:()=>{m(!1),l?.(),N?.remove()},onClose:()=>{m(!1),p?.(),N?.remove()},onConfirm:()=>{m(!1),a?.(),N?.remove()},confirmLabel:u,allowHTML:s})})});we.default.createRoot(document.createElement("div")).render((0,Y.jsx)(c,{}))}var K=Xe;var U=n(I(),1);(()=>{let e=`.dropdown{position:relative;min-width:100px;width:fit-content;font-size:14px!important;cursor:pointer;.dropdown--disabled{opacity:.5;cursor:not-allowed}.dropdown__button{display:flex;border:none;justify-content:space-between;align-items:center;padding:0 8px;background:rgba(var(--spice-rgb-selected-row),.1);color:rgba(var(--spice-rgb-text),.8);border-radius:4px;height:32px;width:100%}.dropdown__arrow{display:flex}.dropdown__menu{background:var(--spice-card);border-radius:4px;box-shadow:0 4px 12px #0003;color:rgba(var(--spice-rgb-text),.8);border:solid rgba(var(--spice-rgb-subtext),.1) 1px;overflow-y:scroll;scrollbar-width:none;max-height:250px}.dropdown__option{display:flex;align-items:center;padding:0 8px;height:32px;cursor:pointer;&:first-child{border-top-left-radius:4px;border-top-right-radius:4px}&:last-child{border-bottom-left-radius:4px;border-bottom-right-radius:4px}&:hover,.dropdown__option--selected{background:var(--spice-button)}}}
`,t="shared-dropdown.css";if(document.getElementById(t))return;let o=document.createElement("style");o.id=t,o.textContent=e,document.head.appendChild(o)})();var E=n(f(),1),Ye=(0,U.memo)(({value:e,options:t,onChange:o,disabled:i})=>{let a=(0,U.useId)(),p=(0,U.useRef)(null),g=`--dropdown-anchor-${a.replace(/:/g,"id")}`,l=s=>{o?.({target:{value:s.value}}),p.current?.hidePopover()},u=t.find(s=>s.value===e)?.label||"Select...";return(0,E.jsxs)("div",{className:`dropdown${i?" dropdown--disabled":""}`,children:[(0,E.jsxs)("button",{className:"dropdown__button",popovertarget:a,popovertargetaction:"toggle",disabled:i,style:{anchorName:g},children:[(0,E.jsx)("div",{className:"dropdown__text",children:u}),(0,E.jsx)("div",{className:"dropdown__arrow",children:(0,E.jsx)(R.React.dropdown,{size:12})})]}),(0,E.jsx)("div",{popover:"auto",id:a,ref:p,className:"dropdown__menu",style:{top:`calc(anchor(${g} bottom) + 4px)`,left:`anchor(${g} left)`,width:`anchor-size(${g} width)`},children:t.map(s=>(0,E.jsx)("div",{className:`dropdown__option${e===s.value?" dropdown__option--selected":""}`,onClick:()=>l(s),children:s.label},s.value))})]})}),ke=Ye;var G=n(I(),1);var Ne=n(I(),1);(()=>{let e=`.input{background:rgba(var(--spice-rgb-selected-row),.1);border:0;border-radius:4px;color:rgba(var(--spice-rgb-text),.8);height:32px;width:128px;text-overflow:ellipsis;padding-left:10px;&:disabled{opacity:.5;cursor:not-allowed}}
`,t="shared-input.css";if(document.getElementById(t))return;let o=document.createElement("style");o.id=t,o.textContent=e,document.head.appendChild(o)})();var Me=n(f(),1),Ke=(0,Ne.memo)(({value:e,onChange:t,placeholder:o,disabled:i})=>(0,Me.jsx)("input",{className:"input",type:"text",value:e,onChange:t,placeholder:o,disabled:i})),Ce=Ke;var Te=n(I(),1);var Se=n(I(),1);var re=n(f(),1),et=(0,Se.memo)(({name:e,popupModal:t})=>t?(0,re.jsx)("button",{className:"themeOptionPopupButton",onClick:()=>X({title:e,content:t,isLarge:!1}),"aria-label":"Open popup",children:(0,re.jsx)(R.React.editButton,{size:16})}):null),De=et;var Re=n(I(),1);var ee=n(f(),1),tt=(0,Re.memo)(({tippy:e})=>(0,ee.jsx)(Spicetify.ReactComponent.TooltipWrapper,{label:e,placement:"top",showDelay:0,children:(0,ee.jsx)("div",{className:"themeOptionTippy",children:(0,ee.jsx)(R.React.questionMark,{size:20,fill:"var(--spice-subtext)"})})})),Pe=tt;(()=>{let e=`.themeOptionRow{display:flex;height:32px;justify-content:space-between}.themeOptionDesc{display:flex;height:100%;align-items:center;font-size:15px;color:var(--spice-subtext)}.themeOptionControl{align-content:center;display:flex;gap:8px}
`,t="shared-optionRow.css";if(document.getElementById(t))return;let o=document.createElement("style");o.id=t,o.textContent=e,document.head.appendChild(o)})();var $=n(f(),1),ot=(0,Te.memo)(({name:e,desc:t,tippy:o,children:i,popupModal:a})=>(0,$.jsxs)("div",{className:"themeOptionRow","data-name":`theme:${e}`,children:[(0,$.jsx)("div",{className:"themeOptionContent",children:(0,$.jsx)("div",{className:"themeOptionDesc",children:t})}),(0,$.jsxs)("div",{className:"themeOptionControl",children:[o&&(0,$.jsx)(Pe,{tippy:o}),(0,$.jsx)(De,{name:e,popupModal:a}),i]})]})),le=ot;var Ie=n(I(),1);(()=>{let e=`.toggle{display:flex;align-items:center;border:none;background:none;cursor:pointer;&:disabled{opacity:.5;cursor:not-allowed}.toggle__background{width:42px;height:24px;background:rgba(var(--spice-rgb-selected-row),.1);border-radius:12px;display:flex;align-items:center;&:has(.toggle__slider--enabled){background:var(--spice-button)}.toggle__slider--enabled{margin-left:20px}}.toggle__slider{width:20px;height:20px;background:var(--spice-text);border-radius:50%;margin-left:2px;transition:.1s cubic-bezier(.45,.05,.55,.95);box-shadow:0 0 5px rgba(var(--spice-rgb-shadow),.3)}}
`,t="shared-toggle.css";if(document.getElementById(t))return;let o=document.createElement("style");o.id=t,o.textContent=e,document.head.appendChild(o)})();var te=n(f(),1),st=(0,Ie.memo)(({value:e,onChange:t,disabled:o})=>(0,te.jsx)("button",{className:"toggle",onClick:t,disabled:o,children:(0,te.jsx)("span",{className:"toggle__background",children:(0,te.jsx)("span",{className:`toggle__slider${e?" toggle__slider--enabled":""}${o?" toggle__slider--disabled":""}`})})})),ze=st;var w=n(f(),1),Le=["live","remix","mix","acoustic","instrumental","radio","version","ver","edit","mono","stereo","deluxe","intro","outro","remastered","bonus","feat","ft","explicit","clean","piano","guitar","cover","original","extended","album","single"],ce={groupSettings:{exact:!0,isrc:!0,likely:!0,possible:!0},confirmSettings:{exact:!1,isrc:!1,likely:!0,possible:!0},defaultNormalizeWords:Le,customNormalizeWords:[]},Ae=()=>{try{let e=localStorage.getItem("findDupeTracks");if(e){let t=JSON.parse(e);return t.defaultNormalizeWords||(t.defaultNormalizeWords=[...Le]),t}return ce}catch(e){return console.error("Error loading settings:",e),ce}},at=e=>{localStorage.setItem("findDupeTracks",JSON.stringify(e))},oe=()=>Ae(),it=()=>{let[e,t]=(0,G.useState)(Ae()),[o,i]=(0,G.useState)("");(0,G.useEffect)(()=>{at(e)},[e]);let a=(s,c,y)=>(0,w.jsxs)("section",{className:"dupe-settings__section",children:[(0,w.jsx)("h3",{className:"dupe-settings__section-title",children:s}),(0,w.jsx)("div",{className:"dupe-settings__options",children:Object.entries(y).map(([m,N])=>(0,w.jsx)(le,{name:`${m}-${c}`,desc:N,children:(0,w.jsx)(ze,{value:e[c][m],onChange:()=>t(T=>({...T,[c]:{...T[c],[m]:!T[c][m]}}))})},m))})]}),p=()=>{let s=o.trim().toLowerCase();s&&(e.customNormalizeWords.includes(s)||e.defaultNormalizeWords.includes(s)||(t(c=>({...c,customNormalizeWords:[...c.customNormalizeWords,s]})),i("")))},g=(s,c)=>{t(y=>c?{...y,defaultNormalizeWords:y.defaultNormalizeWords.filter(m=>m!==s)}:{...y,customNormalizeWords:y.customNormalizeWords.filter(m=>m!==s)})},l=()=>{K({titleText:"Are you sure?",descriptionText:"This will reset all settings to default!",confirmText:"Reset",onConfirm:()=>t(JSON.parse(JSON.stringify(ce)))})},u=[...e.defaultNormalizeWords.map(s=>({word:s,isDefault:!0})),...e.customNormalizeWords.map(s=>({word:s,isDefault:!1}))];return(0,w.jsxs)("div",{className:"dupe-settings",children:[a("Duplicate Groups to Display","groupSettings",{exact:"Exact Duplicates (Same URI)",isrc:"ISRC Duplicates (Same Recording)",likely:"Likely Duplicates (Same Name)",possible:"Possible Duplicates (Similar Name)"}),a("Confirm Before Deleting","confirmSettings",{exact:"Exact Duplicates",isrc:"ISRC Duplicates",likely:"Likely Duplicates",possible:"Possible Duplicates"}),(0,w.jsxs)("section",{className:"dupe-settings__section",children:[(0,w.jsx)("h3",{className:"dupe-settings__section-title",children:"Normalization Words"}),(0,w.jsx)("p",{className:"dupe-settings__description",children:"Add or remove words to be ignored when comparing track names for similarity."}),(0,w.jsxs)(le,{name:"custom-words",desc:"Add a word to normalization list",children:[(0,w.jsx)(Ce,{value:o,onChange:s=>i(s.target.value),placeholder:"Enter word to normalize",disabled:!1,onKeyDown:s=>s.key==="Enter"&&p()}),(0,w.jsx)("button",{type:"button",onClick:p,style:{marginLeft:8},children:"Add"})]}),(0,w.jsx)("div",{className:"dupe-settings__words-list",children:u.length>0?(0,w.jsx)("div",{className:"dupe-settings__words-ul",children:u.map(({word:s,isDefault:c})=>(0,w.jsxs)("div",{className:"dupe-settings__word-item",children:[s,(0,w.jsx)("button",{type:"button",className:"dupe-settings__word-remove",onClick:()=>g(s,c),children:"Remove"})]},s))}):(0,w.jsx)("p",{className:"dupe-settings__no-words",children:"No normalization words"})})]}),(0,w.jsx)("div",{className:"dupe-settings__actions",children:(0,w.jsx)("button",{type:"button",className:"dupe-settings__reset",onClick:l,children:"Reset to Defaults"})})]})},Ee=it;var r=n(f(),1),W=new Dexie("findDupeTracks");W.version(1).stores({tracks:"&trackUri, trackName, albumUri, playCount, isrc"});async function nt(e=100){let t=await Spicetify.Platform.LibraryAPI.getContents({offset:0,limit:e}),o=t.items.filter(a=>a.type==="playlist"&&a.isOwnedBySelf),i=t.totalLength;if(i>e){let a=Math.ceil((i-e)/e),p=Array.from({length:a},(l,u)=>e*(u+1)),g=await Promise.all(p.map(l=>Spicetify.Platform.LibraryAPI.getContents({offset:l,limit:e})));for(let l of g)o=o.concat(l.items.filter(u=>u.type==="playlist"&&u.isOwnedBySelf))}return o}async function rt(e,t=5e3){let o=await Spicetify.Platform.PlaylistAPI.getContents(e,{offset:0,limit:t}),i=o.items,a=o.totalLength;if(a>t){let s=Math.ceil((a-t)/t),c=Array.from({length:s},(m,N)=>t*(N+1)),y=await Promise.all(c.map(m=>Spicetify.Platform.PlaylistAPI.getContents(e,{offset:m,limit:t}).then(N=>N.items)));i=i.concat(y.flat())}let p=i.map(s=>s.uri),g=await W.tracks.bulkGet(p),l=new Map(g.filter(Boolean).map(s=>[s.trackUri,s])),u=i.map(s=>{let c=l.get(s.uri);return{trackUri:s.uri,trackName:s.name,albumUri:s.album.uri,playCount:c?.playCount??null,isrc:c?.isrc??null}});return await W.tracks.bulkPut(u),{items:i,totalLength:a}}async function lt(e){let t=new Map,o=await W.tracks.bulkGet(e),i=[];o.forEach((p,g)=>{let l=e[g];p?.isrc?t.set(l,p.isrc):i.push(l)});let a=[];if(i.length>0){let p=i.map(s=>Spicetify.URI.fromString(s).id),g=50,l=[];for(let s=0;s<p.length;s+=g){let y=`https://api.spotify.com/v1/tracks?ids=${p.slice(s,s+g).join(",")}`;l.push(Spicetify.CosmosAsync.get(y))}let u=await Promise.all(l);for(let s of u)for(let c of s.tracks){let y=c?.external_ids?.isrc,m=c?.uri;y&&m&&(t.set(m,y),a.push({key:m,changes:{isrc:y}}))}}return a.length>0&&await W.tracks.bulkUpdate(a),t}async function ct(e){let t=new Map,o=e.map(l=>l.uri),i=await W.tracks.bulkGet(o),a=new Map,p=new Map;for(let l of i){let u=l.trackUri;if(p.set(u,l),l.playCount!=null)t.set(u,l.playCount);else{let s=e.find(c=>c.uri===u);s?.album?.uri&&(t.set(u,null),a.set(u,s.album.uri))}}let g=[];if(a.size>0){let l=new Map;a.forEach((s,c)=>{l.set(s,l.get(s)||new Set),l.get(s).add(c)});let u=Array.from(l.entries()).map(async([s,c])=>{let m=(await Spicetify.GraphQL.Request(Spicetify.GraphQL.Definitions.getAlbum,{uri:s,locale:Spicetify.Locale.getLocale(),offset:0,limit:5e3}))?.data?.albumUnion?.tracksV2?.items;if(m)for(let N of m){let T=N?.track?.uri;if(c.has(T)){let q=N.track.playcount,Z=q?Number.parseInt(q,10):0;t.set(T,Z),g.push({key:T,changes:{playCount:Z}})}}});await Promise.all(u)}return g.length>0&&await W.tracks.bulkUpdate(g),t}var Oe=(e,t)=>t.get(e)??0,dt=e=>{let t=oe(),i=[...t.defaultNormalizeWords,...t.customNormalizeWords].join("|"),a=new RegExp(`\\b(${i})\\b`,"gi");return e.toLowerCase().replace(/\(.*?\)|\[.*?\]/g,"").replace(a,"").replace(/-/g," ").replace(/[^\p{L}\p{N}\s]/gu,"").replace(/\s+/g," ").trim()};function pt({selectedPlaylist:e}){let[t,o]=(0,S.useState)([]),[i,a]=(0,S.useState)(e?.uri||""),[p,g]=(0,S.useState)(e||null),[l,u]=(0,S.useState)([]),[s,c]=(0,S.useState)(new Map),[y,m]=(0,S.useState)(new Map),[N,T]=(0,S.useState)({exact:[],isrc:[],likely:[],possible:[]});(0,S.useEffect)(()=>{let d=!0;return(async()=>{let b=await nt();if(!d)return;o(b);let h=e?.uri||b[0]?.uri||"";a(h),g(e||b.find(x=>x.uri===h)||null)})(),()=>{d=!1}},[e]);let q=d=>{let b=d.target.value;a(b);let h=t.find(x=>x.uri===b);h&&g(h)},Z=(0,S.useCallback)((d,b,h)=>{let x=new Set,v=(k,Ze,Fe)=>{let Q=new Map;for(let L of k){if(x.has(L.uri))continue;let O=Fe(Ze(L));O&&(Q.set(O,Q.get(O)||[]),Q.get(O).push(L))}let me=[];for(let L of Q.values())if(L.length>1){L.sort((O,He)=>Oe(He.uri,b)-Oe(O.uri,b));for(let O of L)x.add(O.uri);me.push({mainTrack:L[0],duplicates:L.slice(1)})}return me},P=v(d,k=>k.uri,k=>k),C=v(d,k=>h.get(k.uri),k=>k),B=v(d,k=>k.name,k=>k.trim()),F=v(d,k=>k.name,dt);T({exact:P,isrc:C,likely:B,possible:F})},[]),pe=async(d,b,h)=>{await Spicetify.Platform.PlaylistAPI.remove(i,[{uid:d.uid}]),T(x=>{let v=x[b],P=v[h],C=P.duplicates.filter(k=>!(k.uri===d.uri&&k.uid===d.uid)),B={...P,duplicates:C},F=[...v];return B.duplicates.length>0?F[h]=B:F.splice(h,1),{...x,[b]:F}}),u(x=>x.filter(v=>!(v.uri===d.uri&&v.uid===d.uid)))},We=async(d,b,h)=>{if(!oe().confirmSettings[d]){await pe(h,d,b);return}K({titleText:"Remove Track",descriptionText:`Are you sure you want to remove "${h.name}"? This cannot be undone.`,confirmText:"Remove",onConfirm:()=>pe(h,d,b)})};(0,S.useEffect)(()=>{let d={exact:[],isrc:[],likely:[],possible:[]};u([]),T(d),c(new Map),m(new Map),(async()=>{let x=(await rt(i)).items;if(u(x),x.length>0){let v=x.map(B=>B.uri),[P,C]=await Promise.all([ct(x),lt(v)]);c(P),m(C),Z(x,P,C)}})()},[i,Z]);let ue=(0,S.memo)(({track:d})=>{let b=s.get(d.uri),h=b!=null?b.toLocaleString():"N/A",x=y.get(d.uri)||"N/A",v=d.album?.name||"N/A",P=d.artists?.map(C=>C.name).join(", ")||"N/A";return(0,r.jsxs)("div",{className:"dupe-group__details",children:[(0,r.jsxs)("div",{className:"dupe-group__line",children:[(0,r.jsxs)("span",{className:"dupe-group__artists",children:[" Artists: ",P]}),(0,r.jsxs)("span",{className:"dupe-group__album",children:[" Album: ",v]})]}),(0,r.jsxs)("div",{className:"dupe-group__line",children:[(0,r.jsxs)("span",{className:"dupe-group__playcount",children:[" Plays: ",h]}),(0,r.jsxs)("span",{className:"dupe-group__isrc",children:[" ISRC: ",x]})]})]})}),J=(d,b,h)=>oe().groupSettings[h]?(0,r.jsxs)("div",{className:"dupe-group",children:[(0,r.jsxs)("p",{className:"dupe-group__heading",children:[(0,r.jsx)("div",{className:"dupe-group__heading-title",children:d}),(0,r.jsxs)("div",{className:"dupe-group__heading-length",children:[b.length," found"]})]}),b.length>0?(0,r.jsx)("div",{className:"dupe-group__list",children:b.map((v,P)=>(0,r.jsxs)("div",{className:`dupe-group__item dupe-group__item--${h}`,children:[(0,r.jsxs)("div",{className:"dupe-group__source",children:["Source: ",v.mainTrack.name,(0,r.jsx)(ue,{track:v.mainTrack})]}),(0,r.jsx)("div",{className:"dupe-group__duplicates-label",children:"Duplicates:"}),(0,r.jsx)("div",{className:"dupe-group__duplicates-list",children:v.duplicates.map(C=>(0,r.jsxs)("div",{className:"dupe-group__duplicate-item",children:[(0,r.jsxs)("div",{className:"dupe-group__duplicate-content",children:[(0,r.jsx)("span",{className:"dupe-group__duplicate-name",children:C.name}),(0,r.jsx)(ue,{track:C})]}),(0,r.jsx)("button",{className:"dupe-group__delete-button",onClick:()=>We(h,P,C),children:"Delete"})]},`${C.uri}-${C.uid||C.uri}`))})]},`${v.mainTrack.uri}-${v.mainTrack.uid||P}`))}):(0,r.jsx)("p",{children:"No duplicates found in this category."})]}):null,Be=p?p.name:"Select a playlist",Ue=t.map(d=>({value:d.uri,label:d.name}));return(0,r.jsxs)("div",{className:"find-dupes",children:[(0,r.jsxs)("div",{className:"find-dupes__header",children:[(0,r.jsx)("span",{className:"find-dupes__header-label",children:"Select Playlist:"}),(0,r.jsx)(ke,{value:i,options:Ue,onChange:q,disabled:t.length===0})]}),i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"find-dupes__details",children:["Playlist: ",Be," (",l.length," tracks analyzed)"]}),(0,r.jsxs)(r.Fragment,{children:[J("Exact Duplicates (Same URI)",N.exact,"exact"),J("ISRC Duplicates (Same Recording)",N.isrc,"isrc"),J("Likely Duplicates (Same Name)",N.likely,"likely"),J("Possible Duplicates (Similar Name)",N.possible,"possible")]})]})]})}var $e=pt;(()=>{let e=`.find-dupes{display:flex;flex-direction:column;gap:10px;width:100%}.find-dupes__header{display:flex;align-items:center;gap:10px}.find-dupes__header-label{color:var(--spice-text);font-weight:700}.find-dupes__details{font-size:1.25em;color:var(--spice-text)}.dupe-group{display:flex;flex-direction:column;gap:10px;background-color:var(--spice-player);border:1px solid rgba(var(--spice-rgb-selected-row),.1);border-radius:6px;padding:12px}.dupe-group__heading{display:flex;justify-content:space-between;font-weight:700;font-size:1.2em;color:var(--spice-text)}.dupe-group__heading-length{background:#ff676746;border:1px solid #ff575766;font-size:12px;font-weight:400;border-radius:100px;padding:0 12px;align-content:center}.dupe-group__list{display:flex;flex-direction:column;gap:10px}.dupe-group__item{display:flex;flex-direction:column;gap:5px;padding:15px;border-radius:4px;border:1px solid rgba(var(--spice-rgb-selected-row),.1);border-left:4px solid}.dupe-group__item--exact{border-left-color:#ff5a5a}.dupe-group__item--isrc{border-left-color:#ff9050}.dupe-group__item--likely{border-left-color:#eaea66}.dupe-group__item--possible{border-left-color:#80ef80}.dupe-group__source{font-weight:700;color:var(--spice-text);font-size:1.05em}.dupe-group__duplicates-label{font-weight:400;color:var(--spice-subtext);font-size:.95em}.dupe-group__duplicates-list{padding-left:15px;display:flex;flex-direction:column}.dupe-group__line{display:flex;gap:8px}.dupe-group__duplicate-name{font-weight:600}.dupe-group__duplicate-item{font-size:1em;border-bottom:1px solid rgba(var(--spice-rgb-selected-row),.1);display:flex;justify-content:space-between;align-items:center;gap:10px}.dupe-group__duplicate-item:last-child{border-bottom:none}.dupe-group__duplicates-label{color:var(--spice-text);font-size:16px;font-weight:600}.dupe-group__details{display:flex;flex-direction:column;color:var(--spice-subtext);font-size:.9em}.dupe-group__delete-button{background-color:#ff5a5a;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:.85em;font-weight:700;&:hover{background-color:#d34f4f}&:active{background-color:#c72c2c;transform:scale(.98)}}.dupe-settings{width:100%}.dupe-settings__section{margin-bottom:24px}.dupe-settings__section-title{font-size:16px;font-weight:700;margin-bottom:16px;border-bottom:1px solid rgba(255,255,255,.1);padding-bottom:8px}.dupe-settings__description{margin-bottom:12px;opacity:.7;font-size:13px}.dupe-settings__options{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}.dupe-settings__option{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background-color:#0003;border-radius:4px}.dupe-settings__words-list{max-height:200px;overflow-y:auto}.dupe-settings__words-ul{padding:0;margin:0}.dupe-settings__word-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background-color:#0003;border-radius:4px;margin-bottom:8px}.dupe-settings__word-item .dupe-settings__word-remove{background-color:#ff5a5a;border:none;color:#fff;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px;&:hover{background-color:#d34f4f}}.dupe-settings__words-list .dupe-settings__no-words{padding:12px;text-align:center;background-color:#0003;border-radius:4px;opacity:.7}.dupe-settings__actions{display:flex;justify-content:flex-end;margin-top:24px}.dupe-settings__actions .dupe-settings__reset{background-color:#ff32324d;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;&:hover{background-color:#ff323299}}
`,t="findDupeTracks-styles.css";if(document.getElementById(t))return;let o=document.createElement("style");o.id=t,o.textContent=e,document.head.appendChild(o)})();var D=n(f(),1),ut=(e,t="main")=>{let o=i=>{let a=i==="settings";X({title:a?"Find Duplicates Settings":"Find Duplicates",content:a?(0,D.jsx)(Ee,{}):(0,D.jsx)($e,{selectedPlaylist:e}),isLarge:!0,buttons:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Spicetify.ReactComponent.TooltipWrapper,{label:a?"Back to Duplicates":"Settings",placement:"top",children:(0,D.jsx)("button",{className:`Modal__button Modal__button--${a?"back":"settings"}`,onClick:()=>o(a?"main":"settings"),children:a?(0,D.jsx)(R.React.duplicate,{size:18}):(0,D.jsx)(R.React.settings,{size:18})})}),(0,D.jsx)(Spicetify.ReactComponent.TooltipWrapper,{label:"GitHub",placement:"top",children:(0,D.jsx)("button",{className:"Modal__button Modal__button--github",onClick:()=>window.open("https://github.com/veryboringhwl/spicetify-extensions"),children:(0,D.jsx)(R.React.github,{size:18})})})]})})};o(t)},de=null,mt=new Spicetify.ContextMenuV2.Item({children:"Find Duplicates",leadingIcon:R.HTML.duplicate,onClick:async()=>{let e=await Spicetify.Platform.PlaylistAPI.getMetadata(de),t={uri:de,name:e.name};ut(t)},shouldAdd:(e,t,o)=>{let a=Spicetify.ContextMenuV2.parseProps(e)?.[0]?.[0],p=Spicetify.URI.isPlaylistV1OrV2(a);return de=p?a:null,p}});mt.register();
})();
